{"ast":null,"code":"var _jsxFileName = \"/Users/arseny0304/Desktop/full_service/frontend/src/components/D3BarChart.jsx\",\n  _s = $RefreshSig$();\n// frontend/src/components/D3BarChart.jsx\n\nimport React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\n\n/**\n * Переносит длинный текст подписи на несколько строк по пробелам.\n * textSelection — d3 selection элементов <text>\n * width — максимальная ширина (обычно x.bandwidth())\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction wrap(textSelection, width) {\n  textSelection.each(function () {\n    const text = d3.select(this);\n    const words = text.text().split(/\\s+/).reverse();\n    let word;\n    let line = [];\n    let lineNumber = 0;\n    const lineHeight = 1.1; // line-height в em\n    const y = text.attr(\"y\");\n    const dy = parseFloat(text.attr(\"dy\")) || 0;\n\n    // очищаем текст\n    text.text(null);\n    let tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n    while (word = words.pop()) {\n      line.push(word);\n      tspan.text(line.join(\" \"));\n      if (tspan.node().getComputedTextLength() > width) {\n        line.pop();\n        tspan.text(line.join(\" \"));\n        line = [word];\n        tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n      }\n    }\n  });\n}\nexport default function D3BarChart({\n  data,\n  labelKey,\n  valueKey,\n  color\n}) {\n  _s();\n  const svgRef = useRef();\n  useEffect(() => {\n    if (!Array.isArray(data) || data.length === 0) return;\n    const svg = d3.select(svgRef.current);\n    const width = 700;\n    const height = 400;\n    const margin = {\n      top: 20,\n      right: 20,\n      bottom: 120,\n      left: 60\n    };\n    svg.attr(\"viewBox\", `0 0 ${width} ${height}`).style(\"overflow\", \"visible\");\n\n    // чистим перед перерисовкой\n    svg.selectAll(\"*\").remove();\n\n    // шкалы\n    const x = d3.scaleBand().domain(data.map(d => d[labelKey])).range([margin.left, width - margin.right]).padding(0.2);\n    const y = d3.scaleLinear().domain([0, d3.max(data, d => d[valueKey])]).nice().range([height - margin.bottom, margin.top]);\n\n    // ось X\n    const xAxis = g => g.attr(\"transform\", `translate(0,${height - margin.bottom})`).call(d3.axisBottom(x).tickSize(0)).call(g => g.selectAll(\"text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.8em\").call(wrap, x.bandwidth())).call(g => g.select(\".domain\").remove());\n\n    // ось Y\n    const yAxis = g => g.attr(\"transform\", `translate(${margin.left},0)`).call(d3.axisLeft(y).ticks(5).tickSize(-(width - margin.left - margin.right))).call(g => g.select(\".domain\").remove()).call(g => g.selectAll(\".tick line\").attr(\"stroke-opacity\", 0.1));\n    svg.append(\"g\").call(xAxis);\n    svg.append(\"g\").call(yAxis);\n\n    // бары\n    svg.selectAll(\".bar\").data(data).join(\"rect\").attr(\"class\", \"bar\").attr(\"x\", d => x(d[labelKey])).attr(\"y\", d => y(d[valueKey])).attr(\"width\", x.bandwidth()).attr(\"height\", d => y(0) - y(d[valueKey])).attr(\"fill\", color || \"#ff69b4\");\n  }, [data, labelKey, valueKey, color]);\n  return /*#__PURE__*/_jsxDEV(\"svg\", {\n    ref: svgRef,\n    style: {\n      width: \"100%\",\n      height: \"auto\",\n      display: \"block\",\n      margin: \"0 auto\"\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 110,\n    columnNumber: 5\n  }, this);\n}\n_s(D3BarChart, \"89Ty783ABEwsfMbSOeu9vscWF34=\");\n_c = D3BarChart;\nvar _c;\n$RefreshReg$(_c, \"D3BarChart\");","map":{"version":3,"names":["React","useRef","useEffect","d3","jsxDEV","_jsxDEV","wrap","textSelection","width","each","text","select","words","split","reverse","word","line","lineNumber","lineHeight","y","attr","dy","parseFloat","tspan","append","pop","push","join","node","getComputedTextLength","D3BarChart","data","labelKey","valueKey","color","_s","svgRef","Array","isArray","length","svg","current","height","margin","top","right","bottom","left","style","selectAll","remove","x","scaleBand","domain","map","d","range","padding","scaleLinear","max","nice","xAxis","g","call","axisBottom","tickSize","bandwidth","yAxis","axisLeft","ticks","ref","display","fileName","_jsxFileName","columnNumber","_c","$RefreshReg$"],"sources":["/Users/arseny0304/Desktop/full_service/frontend/src/components/D3BarChart.jsx"],"sourcesContent":["// frontend/src/components/D3BarChart.jsx\n\nimport React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\n\n/**\n * Переносит длинный текст подписи на несколько строк по пробелам.\n * textSelection — d3 selection элементов <text>\n * width — максимальная ширина (обычно x.bandwidth())\n */\nfunction wrap(textSelection, width) {\n  textSelection.each(function() {\n    const text = d3.select(this);\n    const words = text.text().split(/\\s+/).reverse();\n    let word;\n    let line = [];\n    let lineNumber = 0;\n    const lineHeight = 1.1; // line-height в em\n    const y = text.attr(\"y\");\n    const dy = parseFloat(text.attr(\"dy\")) || 0;\n\n    // очищаем текст\n    text.text(null);\n\n    let tspan = text.append(\"tspan\")\n      .attr(\"x\", 0)\n      .attr(\"y\", y)\n      .attr(\"dy\", dy + \"em\");\n\n    while (word = words.pop()) {\n      line.push(word);\n      tspan.text(line.join(\" \"));\n      if (tspan.node().getComputedTextLength() > width) {\n        line.pop();\n        tspan.text(line.join(\" \"));\n        line = [word];\n        tspan = text.append(\"tspan\")\n          .attr(\"x\", 0)\n          .attr(\"y\", y)\n          .attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\")\n          .text(word);\n      }\n    }\n  });\n}\n\nexport default function D3BarChart({ data, labelKey, valueKey, color }) {\n  const svgRef = useRef();\n\n  useEffect(() => {\n    if (!Array.isArray(data) || data.length === 0) return;\n    const svg = d3.select(svgRef.current);\n    const width = 700;\n    const height = 400;\n    const margin = { top: 20, right: 20, bottom: 120, left: 60 };\n\n    svg.attr(\"viewBox\", `0 0 ${width} ${height}`)\n       .style(\"overflow\", \"visible\");\n\n    // чистим перед перерисовкой\n    svg.selectAll(\"*\").remove();\n\n    // шкалы\n    const x = d3.scaleBand()\n      .domain(data.map(d => d[labelKey]))\n      .range([margin.left, width - margin.right])\n      .padding(0.2);\n\n    const y = d3.scaleLinear()\n      .domain([0, d3.max(data, d => d[valueKey])]).nice()\n      .range([height - margin.bottom, margin.top]);\n\n    // ось X\n    const xAxis = g => g\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n      .call(d3.axisBottom(x).tickSize(0))\n      .call(g => g.selectAll(\"text\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"dy\", \"0.8em\")\n        .call(wrap, x.bandwidth())\n      )\n      .call(g => g.select(\".domain\").remove());\n\n    // ось Y\n    const yAxis = g => g\n      .attr(\"transform\", `translate(${margin.left},0)`)\n      .call(d3.axisLeft(y).ticks(5).tickSize(- (width - margin.left - margin.right)))\n      .call(g => g.select(\".domain\").remove())\n      .call(g => g.selectAll(\".tick line\")\n        .attr(\"stroke-opacity\", 0.1)\n      );\n\n    svg.append(\"g\").call(xAxis);\n    svg.append(\"g\").call(yAxis);\n\n    // бары\n    svg.selectAll(\".bar\")\n      .data(data)\n      .join(\"rect\")\n        .attr(\"class\", \"bar\")\n        .attr(\"x\", d => x(d[labelKey]))\n        .attr(\"y\", d => y(d[valueKey]))\n        .attr(\"width\", x.bandwidth())\n        .attr(\"height\", d => y(0) - y(d[valueKey]))\n        .attr(\"fill\", color || \"#ff69b4\");\n\n  }, [data, labelKey, valueKey, color]);\n\n  return (\n    <svg\n      ref={svgRef}\n      style={{\n        width: \"100%\",\n        height: \"auto\",\n        display: \"block\",\n        margin: \"0 auto\"\n      }}\n    />\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}