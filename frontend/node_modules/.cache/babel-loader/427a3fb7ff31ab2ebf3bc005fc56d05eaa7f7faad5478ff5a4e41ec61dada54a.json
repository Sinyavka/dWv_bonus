{"ast":null,"code":"var _jsxFileName = \"/Users/arseny0304/Desktop/full_service/frontend/src/components/D3BarChart.jsx\",\n  _s = $RefreshSig$();\n// frontend/src/components/D3BarChart.jsx\n\nimport React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\n\n/**\n * Переносит текст на несколько строк, если он шире, чем width.\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction wrap(textSelection, width) {\n  textSelection.each(function () {\n    const text = d3.select(this);\n    const words = text.text().split(/\\s+/).reverse();\n    let line = [],\n      lineNumber = 0;\n    const lineHeight = 1.1; // ems\n    const y = text.attr(\"y\");\n    const dy = parseFloat(text.attr(\"dy\")) || 0;\n    text.text(null);\n    let tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n    let word;\n    while (word = words.pop()) {\n      line.push(word);\n      tspan.text(line.join(\" \"));\n      if (tspan.node().getComputedTextLength() > width) {\n        line.pop();\n        tspan.text(line.join(\" \"));\n        line = [word];\n        tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n      }\n    }\n  });\n}\nexport default function D3BarChart({\n  data,\n  labelKey,\n  valueKey,\n  color\n}) {\n  _s();\n  const svgRef = useRef();\n  useEffect(() => {\n    if (!Array.isArray(data) || data.length === 0) return;\n\n    // параметры\n    const barWidth = 50; // px на один бар (включая отступ)\n    const margin = {\n      top: 20,\n      right: 20,\n      bottom: 120,\n      left: 60\n    };\n    const height = 400;\n    const width = margin.left + margin.right + data.length * barWidth;\n\n    // селект и сброс\n    const svg = d3.select(svgRef.current).attr(\"width\", width).attr(\"height\", height).attr(\"viewBox\", `0 0 ${width} ${height}`).style(\"overflow\", \"visible\");\n    svg.selectAll(\"*\").remove();\n\n    // шкалы\n    const x = d3.scaleBand().domain(data.map(d => d[labelKey])).range([margin.left, width - margin.right]).padding(0.2);\n    const y = d3.scaleLinear().domain([0, d3.max(data, d => d[valueKey])]).nice().range([height - margin.bottom, margin.top]);\n\n    // ось Y\n    svg.append(\"g\").attr(\"transform\", `translate(${margin.left},0)`).call(d3.axisLeft(y).ticks(5).tickSize(-(width - margin.left - margin.right))).call(g => g.select(\".domain\").remove()).call(g => g.selectAll(\".tick line\").attr(\"stroke-opacity\", 0.1));\n\n    // ось X\n    svg.append(\"g\").attr(\"transform\", `translate(0,${height - margin.bottom})`).call(d3.axisBottom(x).tickSize(0)).call(g => g.selectAll(\"text\").attr(\"text-anchor\", \"middle\").attr(\"dy\", \"0.8em\").call(wrap, x.bandwidth())).call(g => g.select(\".domain\").remove());\n\n    // бары\n    svg.selectAll(\".bar\").data(data).join(\"rect\").attr(\"class\", \"bar\").attr(\"x\", d => x(d[labelKey])).attr(\"y\", d => y(d[valueKey])).attr(\"width\", x.bandwidth()).attr(\"height\", d => y(0) - y(d[valueKey])).attr(\"fill\", color || \"#ff69b4\");\n  }, [data, labelKey, valueKey, color]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      overflowX: 'auto'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: svgRef,\n      style: {\n        display: 'block'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 102,\n    columnNumber: 5\n  }, this);\n}\n_s(D3BarChart, \"89Ty783ABEwsfMbSOeu9vscWF34=\");\n_c = D3BarChart;\nvar _c;\n$RefreshReg$(_c, \"D3BarChart\");","map":{"version":3,"names":["React","useRef","useEffect","d3","jsxDEV","_jsxDEV","wrap","textSelection","width","each","text","select","words","split","reverse","line","lineNumber","lineHeight","y","attr","dy","parseFloat","tspan","append","word","pop","push","join","node","getComputedTextLength","D3BarChart","data","labelKey","valueKey","color","_s","svgRef","Array","isArray","length","barWidth","margin","top","right","bottom","left","height","svg","current","style","selectAll","remove","x","scaleBand","domain","map","d","range","padding","scaleLinear","max","nice","call","axisLeft","ticks","tickSize","g","axisBottom","bandwidth","overflowX","children","ref","display","fileName","_jsxFileName","columnNumber","_c","$RefreshReg$"],"sources":["/Users/arseny0304/Desktop/full_service/frontend/src/components/D3BarChart.jsx"],"sourcesContent":["// frontend/src/components/D3BarChart.jsx\n\nimport React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\n\n/**\n * Переносит текст на несколько строк, если он шире, чем width.\n */\nfunction wrap(textSelection, width) {\n  textSelection.each(function() {\n    const text = d3.select(this);\n    const words = text.text().split(/\\s+/).reverse();\n    let line = [], lineNumber = 0;\n    const lineHeight = 1.1; // ems\n    const y = text.attr(\"y\");\n    const dy = parseFloat(text.attr(\"dy\")) || 0;\n    text.text(null);\n    let tspan = text.append(\"tspan\")\n      .attr(\"x\", 0)\n      .attr(\"y\", y)\n      .attr(\"dy\", dy + \"em\");\n    let word;\n    while (word = words.pop()) {\n      line.push(word);\n      tspan.text(line.join(\" \"));\n      if (tspan.node().getComputedTextLength() > width) {\n        line.pop();\n        tspan.text(line.join(\" \"));\n        line = [word];\n        tspan = text.append(\"tspan\")\n          .attr(\"x\", 0)\n          .attr(\"y\", y)\n          .attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\")\n          .text(word);\n      }\n    }\n  });\n}\n\nexport default function D3BarChart({ data, labelKey, valueKey, color }) {\n  const svgRef = useRef();\n\n  useEffect(() => {\n    if (!Array.isArray(data) || data.length === 0) return;\n\n    // параметры\n    const barWidth = 50; // px на один бар (включая отступ)\n    const margin = { top: 20, right: 20, bottom: 120, left: 60 };\n    const height = 400;\n    const width = margin.left + margin.right + data.length * barWidth;\n\n    // селект и сброс\n    const svg = d3.select(svgRef.current)\n      .attr(\"width\", width)\n      .attr(\"height\", height)\n      .attr(\"viewBox\", `0 0 ${width} ${height}`)\n      .style(\"overflow\", \"visible\");\n    svg.selectAll(\"*\").remove();\n\n    // шкалы\n    const x = d3.scaleBand()\n      .domain(data.map(d => d[labelKey]))\n      .range([margin.left, width - margin.right])\n      .padding(0.2);\n\n    const y = d3.scaleLinear()\n      .domain([0, d3.max(data, d => d[valueKey])]).nice()\n      .range([height - margin.bottom, margin.top]);\n\n    // ось Y\n    svg.append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},0)`)\n      .call(d3.axisLeft(y).ticks(5).tickSize(- (width - margin.left - margin.right)))\n      .call(g => g.select(\".domain\").remove())\n      .call(g => g.selectAll(\".tick line\").attr(\"stroke-opacity\", 0.1));\n\n    // ось X\n    svg.append(\"g\")\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n      .call(d3.axisBottom(x).tickSize(0))\n      .call(g => g.selectAll(\"text\")\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"dy\", \"0.8em\")\n        .call(wrap, x.bandwidth())\n      )\n      .call(g => g.select(\".domain\").remove());\n\n    // бары\n    svg.selectAll(\".bar\")\n      .data(data)\n      .join(\"rect\")\n        .attr(\"class\", \"bar\")\n        .attr(\"x\", d => x(d[labelKey]))\n        .attr(\"y\", d => y(d[valueKey]))\n        .attr(\"width\", x.bandwidth())\n        .attr(\"height\", d => y(0) - y(d[valueKey]))\n        .attr(\"fill\", color || \"#ff69b4\");\n\n  }, [data, labelKey, valueKey, color]);\n\n  return (\n    <div style={{ overflowX: 'auto' }}>\n      <svg ref={svgRef} style={{ display: 'block' }} />\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}